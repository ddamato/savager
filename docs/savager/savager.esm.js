function e(e){const t=document.getElementById(e);let r=document.getElementById("savager-mastersheet");r||(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.id="savager-mastersheet",r.style.display="none",document.body.appendChild(r)),Array.prototype.slice.call(t.querySelectorAll("symbol")).forEach(e=>r.appendChild(e)),t.remove()}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r=function(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}((function(e){var r,n;r=t,n=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var s=t.join("/"),i=(s=s.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return s=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=n():r.urljoin=n()}));class n{constructor(){this._registrar={}}get(e){return this._registrar[e]}replace(e){const{url:t,exposure:r,id:n}=this._parseNode(e);if(this.get(n))return Promise.resolve(this._replace(e,n));if("internal"===r){const t=e.getRootNode();if(t.getElementById(n))return Promise.resolve("Reference found in root, replacement halted.");if(e.getRootNode({composed:!0})!==t)return this._embedInternal(e,{id:n})}return"external"===r?this._embedExternal(e,{id:n,url:t}):Promise.reject("Could not find asset reference. Ensure the reference sheet or external url exist before executing this script")}_replace(e,t){const r=this.get(t);if(r){const t=r.cloneNode(!0);t.removeAttribute("id"),t.setAttribute("replaced","");const n=e.parentNode;return n.hasAttributes()&&[...n.attributes].forEach(({name:e,value:r})=>t.setAttribute(e,r)),n.replaceWith(t),t}}register(e,t,r){return this._registrar[t]=r,this._replace(e,t)}_embedInternal(e,{id:t}){const r=document.getElementById(t);if(r){const n=r.cloneNode(!0);return Promise.resolve(this.register(e,t,this._transformSymbol(n)))}return Promise.reject(`Symbol "${t}" not found in document.`)}_embedExternal(e,{id:t,url:r}){return fetch(r).then(e=>e.text()).then(r=>{const n=(new DOMParser).parseFromString(r,"image/svg+xml").querySelector("symbol");if(n)return this.register(e,t,this._transformSymbol(n));throw new Error("Malformed external reference, please ensure '<symbol/>' assets.")}).catch(e=>console.error(e))}_parseNode(e){const t=e.getAttribute("href"),[r,n]=t.split("#");let o=e.getAttribute("exposure");return o||(o=Boolean(r)?"external":"internal"),{url:t,exposure:o,id:n}}_transformSymbol(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.children&&[...e.children].forEach(e=>t.appendChild(e)),e.hasAttributes()&&[...e.attributes].forEach(({name:e,value:r})=>t.setAttribute(e,r)),t}}const o="window.svgInjectionManager && window.svgInjectionManager.replace(this)",s={style:"animation: nodeDetected .1ms",onanimationstart:o,onerror:o},i=()=>{if("undefined"!=typeof window)return window.svgInjectionManager=new n,window.svgInjectionManager};class a{constructor(e,t){this._symbols={},this._options=Object.assign({},t),this.storeSymbols(e)}prepareAssets(t,n){const{externalUrl:o,inject:a,classNames:l,toSvgElement:d,consolidate:p}=n||this._options,g={xmlns:"http://www.w3.org/2000/svg"},m=void 0===p||Boolean(p),f={inject:a?i:Function.prototype};l&&(g.class=[].concat(l).filter(Boolean).join(" "));let h=e=>e;d&&(h="function"==typeof d?d:u);const y=[].concat(t).reduce((function(e,t){const n=Object.assign({exposure:"internal"},g);let i={href:"#"+t};if(o){n.exposure="external";const e="string"==typeof o?o:"";i.href=r(e,t+".svg",i.href)}let l="";a&&(l="<style>@keyframes nodeDetected { to { opacity: 1; } }</style>",i=Object.assign(i,s));const u=`<svg ${c(n)}>${l}<use ${c(i)}/></svg>`;return Object.assign(e,{[t]:u})}),{}),b=this._symbols;let w=Object.keys(y).reduce((function(e,t){return b&&b[t]?e+b[t].replace(/<\/?svg ?[^>]*>/gim,""):e}),"");if(f.assets=Object.entries(y).reduce((function(e,[t,r]){return Object.assign(e,{[t]:h(r)})}),{}),w&&!o){const{sheet:t}=function(t,r){const n="savager-"+Math.random().toString(36).substr(2,9),o=`id="${n}" xmlns="http://www.w3.org/2000/svg" style="display:none;"`;let s="";if(r){const t=`(${e.toString()})('${n}')`.replace(/\"/g,"'");s=`<image href="#" onerror="${t}"/>`}return{sheet:`<svg ${o}>${s}${t}</svg>`}}(w,m);console.log("str",t),f.sheet=h(t),console.log("elem",f.sheet)}return f}storeSymbols(e){return this._symbols=Object.assign({},this._symbols,e),this}}function c(e){return Object.entries(e).map(([e,t])=>`${e}="${t}"`).join(" ")}let l;function u(e){if("undefined"!=typeof document&&document.createElement){l||(l=document.createElement("div")),l.innerHTML=e;const t=document.createDocumentFragment();return[...l.children].forEach(e=>t.appendChild(e)),t}return e}async function d(e){if(!e)return{};if("string"==typeof e){if("undefined"!=typeof window||!require)throw new Error("Can only create symbols using path within node environment.");const t=require("path"),r=require("fs");try{const n=await r.promises.readdir(e),o=await Promise.all(n.map(async n=>({[t.parse(n).name]:(await r.promises.readFile(t.resolve(e,n))).toString()})));return d(o.reduce((e,t)=>Object.assign(e,t),{}))}catch(e){throw new Error(e)}}return"object"==typeof e?Object.entries(e).reduce((e,[t,r])=>Object.assign(e,{[t]:p(r,t)}),{}):void 0}function p(e,t){let r='xmlns="http://www.w3.org/2000/svg"';const n=e.replace(/(xmlns=.[^"']+)./gim,e=>(r=e,"")).replace(/(<\/?)svg/gim,"$1symbol").replace(/<symbol/,`<symbol id="${t}"`);return`<svg ${r}>${n}</svg>`.replace(/\r?\n|\r|/g,"").replace(/ {2,}/g," ")}const g=a;export default a;export{g as Savager,d as createSymbols};
